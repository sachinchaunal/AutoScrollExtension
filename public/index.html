<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoScroll Extension - Official Website</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            padding: 60px 0;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .features {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .features h2 {
            text-align: center;
            margin-bottom: 30px;
            color: #667eea;
            font-size: 2.5rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .feature-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: #f8f9fa;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }
        
        .download-section {
            background: #2c3e50;
            color: white;
            padding: 50px;
            border-radius: 15px;
            text-align: center;
            margin: 40px 0;
        }
        
        .download-section h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
        }
        
        .download-btn {
            display: inline-block;
            background: #27ae60;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.2rem;
            margin: 10px;
            transition: background 0.3s ease;
            cursor: pointer;
            border: none;
        }
        
        .download-btn:hover {
            background: #219a52;
        }
        
        .pricing {
            background: white;
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .pricing h2 {
            color: #667eea;
            font-size: 2.5rem;
            margin-bottom: 30px;
        }
        
        .price-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 400px;
            margin: 0 auto;
        }
        
        .price {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .footer {
            text-align: center;
            color: white;
            padding: 40px 0;
        }
        
        .social-links {
            margin: 20px 0;
        }
        
        .social-links a {
            color: white;
            text-decoration: none;
            margin: 0 15px;
            font-size: 1.5rem;
            transition: opacity 0.3s ease;
        }
        
        .social-links a:hover {
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 999999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border: none;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .submit-btn {
            background: #667eea;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s ease;
        }
        
        .submit-btn:hover {
            background: #5a6fd8;
        }
        
        .submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        /* Original Extension Download Styles - DISABLED
           Users must download Chrome extension instead */
        /*
        .web-extension-section {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            padding: 60px 0;
            margin: 40px 0;
            border-radius: 15px;
        }

        .web-extension-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            max-width: 600px;
            margin: 0 auto;
            min-height: 400px;
        }

        .web-login-screen {
            text-align: center;
        }

        .web-header h3 {
            color: #2c3e50;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .web-subtitle {
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .web-feature-highlights {
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .web-feature {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .web-feature:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .web-icon {
            font-size: 20px;
            margin-right: 12px;
            width: 30px;
        }

        .web-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }

        .web-btn-google {
            background: white;
            color: #333;
            border: 2px solid #e0e0e0;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .web-btn-google:hover {
            background: #f8f9fa;
            border-color: #d0d0d0;
            transform: translateY(-2px);
        }

        .web-btn-google img {
            width: 20px;
            height: 20px;
        }

        .web-auth-info {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .web-auth-info p {
            font-size: 14px;
            color: #666;
            margin: 0;
        }

        .web-main-screen {
            color: #333;
        }

        .web-header-logged {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
        }

        .web-user-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .web-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #e0e0e0;
        }

        .web-user-details {
            display: flex;
            flex-direction: column;
        }

        .web-user-name {
            font-weight: 600;
            color: #2c3e50;
        }

        .web-user-email {
            font-size: 14px;
            color: #7f8c8d;
        }

        .web-btn-logout {
            background: #e74c3c;
            color: white;
        }

        .web-btn-logout:hover {
            background: #c0392b;
        }

        .web-status-section {
            text-align: center;
            margin: 30px 0;
        }

        .web-status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 16px;
            font-weight: 600;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        .web-status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #e74c3c;
            animation: pulse 2s infinite;
        }

        .web-status-dot.active {
            background-color: #27ae60;
        }

        .web-platform-info {
            color: #666;
            font-size: 14px;
        }

        .web-platform-info p {
            margin: 5px 0;
        }

        .web-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin: 30px 0;
        }

        .web-btn-primary {
            background: #3498db;
            color: white;
            width: 100%;
        }

        .web-btn-primary:hover {
            background: #2980b9;
        }

        .web-btn-secondary {
            background: #95a5a6;
            color: white;
            width: 100%;
        }

        .web-btn-secondary:hover {
            background: #7f8c8d;
        }

        .web-subscription-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .web-subscription-info h4 {
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .web-progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .web-progress {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .web-btn-subscribe {
            background: #27ae60;
            color: white;
            width: 100%;
        }

        .web-btn-subscribe:hover {
            background: #229954;
        }

        .web-loading-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 50px;
        }

        .web-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .instruction-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .step {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            display: flex;
            align-items: flex-start;
            gap: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .step-number {
            background: #27ae60;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .step-content h4 {
            color: white;
            margin-bottom: 8px;
        }

        .step-content p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            margin: 0;
        }

        @media (max-width: 768px) {
            .web-extension-container {
                margin: 0 20px;
                padding: 20px;
            }
            
            .instruction-steps {
                grid-template-columns: 1fr;
            }
            
            .web-header-logged {
                flex-direction: column;
                gap: 15px;
            }
        }
        */

        /* Subscription Modal Styles */
        .subscription-section {
            margin: 20px 0;
        }

        .autopay-benefits ul {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 15px 0;
        }

        #qrCodeContainer img {
            max-width: 100%;
            height: auto;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 10px;
            background: white;
        }

        .status-card {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            border-left: 4px solid #27ae60;
        }

        .status-card.pending {
            border-left-color: #f39c12;
        }

        .status-card.error {
            border-left-color: #e74c3c;
        }

        .mandate-details {
            background: #fff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
            border: 1px solid #e0e0e0;
        }

        .mandate-id {
            font-family: monospace;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 4px;
            word-break: break-all;
            font-size: 12px;
        }

        .subscription-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .subscription-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üöÄ AutoScroll Extension</h1>
            <p>Automatically scroll through YouTube Shorts for hands-free viewing experience. Enhance your social media browsing with seamless auto-scrolling.</p>
        </header>

        <section class="features">
            <h2>‚ú® Features</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon">üì±</div>
                    <h3>YouTube Shorts</h3>
                    <p>Automatically scroll through YouTube Shorts for hands-free viewing experience.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">‚ö°</div>
                    <h3>Smart Detection</h3>
                    <p>Intelligent video end detection ensures perfect timing for seamless transitions.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üéØ</div>
                    <h3>Easy Control</h3>
                    <p>Simple one-click start/stop controls right from your browser toolbar.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">üîí</div>
                    <h3>Privacy First</h3>
                    <p>Your data stays private. No tracking, no ads, just pure functionality.</p>
                </div>
            </div>
        </section>

        <!-- Web-Based Extension Section REMOVED - Use Extension Only -->
        
        <section class="download-section">
            <div class="container">
                <h2 style="text-align: center; color: white; margin-bottom: 30px;">üö´ Web Version Disabled</h2>
                <p style="text-align: center; color: white; opacity: 0.9; margin-bottom: 40px;">Please use the Chrome Extension for the best AutoScroll experience!</p>
                
                <div style="text-align: center; background: white; border-radius: 15px; padding: 40px; margin: 20px auto; max-width: 600px;">
                    <h3 style="color: #e74c3c; margin-bottom: 20px;">üö´ Web Version Discontinued</h3>
                    <p style="color: #2c3e50; margin-bottom: 20px;">For the best experience and full features, please download and install the Chrome Extension.</p>
                    <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">
                        <a href="#download" style="background: #27ae60; color: white; padding: 15px 25px; text-decoration: none; border-radius: 8px; font-weight: bold;">üì• Download Extension</a>
                        <a href="https://chrome.google.com/webstore" target="_blank" style="background: #3498db; color: white; padding: 15px 25px; text-decoration: none; border-radius: 8px; font-weight: bold;">üåê Chrome Web Store</a>
                    </div>
                </div>
                
                <!-- Extension Interface -->
                <div class="web-extension-container" id="webExtensionContainer" style="display: none;">
                    <!-- Login Screen -->
                    <div class="web-login-screen" id="webLoginScreen">
                        <div class="web-header">
                            <h3>üöÄ YouTube Shorts AutoScroll</h3>
                            <p class="web-subtitle">Auto-scroll through YouTube Shorts seamlessly</p>
                        </div>
                        
                        <div class="web-login-content">
                            <div class="web-feature-highlights">
                                <div class="web-feature">
                                    <span class="web-icon">‚è≠Ô∏è</span>
                                    <span>Auto-scroll when videos end</span>
                                </div>
                                <div class="web-feature">
                                    <span class="web-icon">‚è±Ô∏è</span>
                                    <span>10-day free trial</span>
                                </div>
                                <div class="web-feature">
                                    <span class="web-icon">üí≥</span>
                                    <span>Only ‚Çπ9/month after trial</span>
                                </div>
                            </div>

                            <div class="web-auth-buttons">
                                <button id="webGoogleLoginBtn" class="web-btn web-btn-google">
                                    <img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIHZpZXdCb3g9IjAgMCAxOCAxOCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTE3LjY0IDkuMjA0NTVDMTcuNjQgOC41NjY4MiAxNy41ODI3IDcuOTUyMjcgMTcuNDggNy4zNjM2NEg5VjEwLjg0NTVIMTMuODQzNkMxMy42MzUgMTEuOTcgMTMuMDAwOSAxMi45MjMgMTIuMDQ3NyAxMy41NjE0VjE1LjgxOTVIMTQuOTU2OEMxNi42NTkxIDE0LjI1MjMgMTcuNjQgMTEuOTQ1NSAxNy42NCA5LjIwNDU1WiIgZmlsbD0iIzQyODVGNCIvPgo8cGF0aCBkPSJNOSAxOEM4LjQxIDEwIDkuMDE4IDExLjA1IDEwIDExLjA1SDEwLjQ1QzEwLjk1IDExLjA1IDExLjQgMTAuNjUgMTEuNCAxMC4xNVY5LjQ1SDEyLjZWMTAuMTVDMTIuNiAxMS4zNSAxMS43IDEyLjI1IDEwLjQ1IDEyLjI1SDEwQzguNzUgMTIuMjUgNy43NSAxMS4yNSA3Ljc1IDEwVjNIMTBWMTBIMTEuNCIgZmlsbD0iIzM0QTg1MyIvPgo8L3N2Zz4K" alt="Google" />
                                    Sign in with Google
                                </button>
                                
                                <div class="web-auth-info">
                                    <p>üîí Secure Google authentication</p>
                                    <p>‚ú® Start your free trial instantly</p>
                                    <p>üåê Works directly in your browser</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main App Screen -->
                    <div class="web-main-screen" id="webMainScreen" style="display: none;">
                        <div class="web-header-logged">
                            <div class="web-user-info">
                                <img id="webUserPicture" src="" alt="User" class="web-user-avatar">
                                <div class="web-user-details">
                                    <span id="webUserName" class="web-user-name">Loading...</span>
                                    <span id="webUserEmail" class="web-user-email">Loading...</span>
                                </div>
                            </div>
                            <button id="webLogoutBtn" class="web-btn web-btn-logout">Logout</button>
                        </div>

                        <div class="web-status-section">
                            <div class="web-status-indicator" id="webStatusIndicator">
                                <span class="web-status-dot" id="webStatusDot"></span>
                                <span id="webStatusText">Inactive</span>
                            </div>
                            <div class="web-platform-info">
                                <p>üé¨ Ready for YouTube Shorts</p>
                                <p>Open YouTube Shorts in a new tab and click Start to begin!</p>
                            </div>
                        </div>

                        <div class="web-controls">
                            <button id="webToggleButton" class="web-btn web-btn-primary">Start AutoScroll</button>
                            <button id="webOpenYouTubeBtn" class="web-btn web-btn-secondary">üé¨ Open YouTube Shorts</button>
                        </div>

                        <div class="web-subscription-info" id="webSubscriptionInfo">
                            <div class="web-trial-info" id="webTrialInfo">
                                <h4>Free Trial</h4>
                                <p id="webTrialDays">Loading...</p>
                                <div class="web-progress-bar">
                                    <div class="web-progress" id="webTrialProgress"></div>
                                </div>
                            </div>

                            <div class="web-subscription-status" id="webSubscriptionStatus" style="display: none;">
                                <h4>Premium Plan</h4>
                                <p id="webSubscriptionText">Active subscription</p>
                            </div>

                            <div class="web-expired-notice" id="webExpiredNotice" style="display: none;">
                                <h4>Trial Expired</h4>
                                <p>Subscribe to continue using YouTube Shorts AutoScroll</p>
                            </div>

                            <button id="webSubscribeButton" class="web-btn web-btn-subscribe">Subscribe to Premium</button>
                        </div>
                    </div>

                    <!-- Loading Screen -->
                    <div class="web-loading-screen" id="webLoadingScreen" style="display: none;">
                        <div class="web-spinner"></div>
                        <p>Loading...</p>
                    </div>
                </div>

                <div class="web-extension-instructions">
                    <h3 style="text-align: center; color: white; margin-top: 40px; margin-bottom: 30px;">üìã How to Use Web AutoScroll</h3>
                    <div class="instruction-steps">
                        <div class="step">
                            <span class="step-number">1</span>
                            <div class="step-content">
                                <h4>Sign In</h4>
                                <p>Click "Sign in with Google" to start your free trial</p>
                            </div>
                        </div>
                        <div class="step">
                            <span class="step-number">2</span>
                            <div class="step-content">
                                <h4>Open YouTube Shorts</h4>
                                <p>Click "Open YouTube Shorts" or manually go to YouTube Shorts</p>
                            </div>
                        </div>
                        <div class="step">
                            <span class="step-number">3</span>
                            <div class="step-content">
                                <h4>Activate AutoScroll</h4>
                                <p>Come back to this tab and click "Start AutoScroll"</p>
                            </div>
                        </div>
                        <div class="step">
                            <span class="step-number">4</span>
                            <div class="step-content">
                                <h4>Enjoy!</h4>
                                <p>Switch back to YouTube Shorts and enjoy hands-free viewing</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <section class="download-section">
            <h2>üì• Get AutoScroll Extension</h2>
            <p>Join thousands of users who have enhanced their browsing experience</p>
            <button class="download-btn" id="chromeStoreBtn">
                üåê Chrome/Edge Web Store (Coming Soon)
            </button>
            <button class="download-btn" id="windowsInstallerBtn">
                ÔøΩ Early Access - Download ZIP
            </button>
        </section>

        <section class="pricing">
            <h2>üí∞ Pricing</h2>
            <div class="price-card">
                <h3>Premium Plan</h3>
                <div class="price">‚Çπ9<span style="font-size: 1rem;">/month</span></div>
                <ul style="text-align: left; margin: 20px 0;">
                    <li>‚úÖ 10-Day Free Trial</li>
                    <li>‚úÖ Unlimited Auto-Scrolling</li>
                    <li>‚úÖ YouTube Shorts Support</li>
                    <li>‚úÖ Priority Support</li>
                    <li>‚úÖ Regular Updates</li>
                </ul>
                <p><strong>Start your free trial today!</strong></p>
            </div>
        </section>

        <footer class="footer">
            <div class="social-links">
                <a href="/contact">üìß Contact</a>
                <a href="/support">üì± Support</a>
                <a href="/privacy">üìã Privacy Policy</a>
                <a href="/terms">üìÑ Terms of Service</a>
            </div>
            <p>&copy; 2025 AutoScroll Extension. All rights reserved.</p>
            <p>üè¢ Business Website for Razorpay Integration</p>
        </footer>
    </div>

    <!-- Contact Modal -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('contactModal')">&times;</span>
            <h2>üìß Contact Us</h2>
            <form id="contactForm">
                <div class="form-group">
                    <label for="contactName">Name *</label>
                    <input type="text" id="contactName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="contactEmail">Email *</label>
                    <input type="email" id="contactEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="contactSubject">Subject *</label>
                    <input type="text" id="contactSubject" name="subject" required>
                </div>
                <div class="form-group">
                    <label for="contactMessage">Message *</label>
                    <textarea id="contactMessage" name="message" required></textarea>
                </div>
                <button type="submit" class="submit-btn">Send Message</button>
            </form>
        </div>
    </div>

    <!-- Support Modal -->
    <div id="supportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('supportModal')">&times;</span>
            <h2>üì± Support Center</h2>
            <form id="supportForm">
                <div class="form-group">
                    <label for="supportName">Name *</label>
                    <input type="text" id="supportName" name="name" required>
                </div>
                <div class="form-group">
                    <label for="supportEmail">Email *</label>
                    <input type="email" id="supportEmail" name="email" required>
                </div>
                <div class="form-group">
                    <label for="supportType">Issue Type *</label>
                    <select id="supportType" name="type" required style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                        <option value="">Select Issue Type</option>
                        <option value="installation">Installation Problem</option>
                        <option value="functionality">Extension Not Working</option>
                        <option value="payment">Payment/Subscription Issue</option>
                        <option value="feature">Feature Request</option>
                        <option value="bug">Bug Report</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="supportMessage">Describe your issue *</label>
                    <textarea id="supportMessage" name="message" required placeholder="Please describe your issue in detail..."></textarea>
                </div>
                <button type="submit" class="submit-btn">Submit Support Request</button>
            </form>
        </div>
    </div>

    <!-- Privacy Policy Modal -->
    <div id="privacyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('privacyModal')">&times;</span>
            <h2>üìã Privacy Policy</h2>
            <div style="text-align: left; line-height: 1.6;">
                <h3>Last Updated: August 6, 2025</h3>
                
                <h4>1. Information We Collect</h4>
                <p>‚Ä¢ Google Account information (email, name, profile picture) for authentication</p>
                <p>‚Ä¢ Usage statistics (anonymized) for improving the extension</p>
                <p>‚Ä¢ Payment information processed securely through Razorpay</p>
                
                <h4>2. How We Use Your Information</h4>
                <p>‚Ä¢ To provide and maintain our extension services</p>
                <p>‚Ä¢ To process subscription payments</p>
                <p>‚Ä¢ To send important updates about your account</p>
                <p>‚Ä¢ To improve our extension functionality</p>
                
                <h4>3. Data Storage and Security</h4>
                <p>‚Ä¢ All data is encrypted and stored securely</p>
                <p>‚Ä¢ We use industry-standard security measures</p>
                <p>‚Ä¢ Payment data is processed by Razorpay (PCI DSS compliant)</p>
                
                <h4>4. Data Sharing</h4>
                <p>‚Ä¢ We do not sell or rent your personal information</p>
                <p>‚Ä¢ We do not share data with third parties except payment processing</p>
                
                <h4>5. Your Rights</h4>
                <p>‚Ä¢ You can request deletion of your account and data</p>
                <p>‚Ä¢ You can export your data</p>
                <p>‚Ä¢ You can opt out of usage analytics</p>
                
                <h4>6. Contact Us</h4>
                <p>For privacy concerns: <strong>sachinchaunal@gmail.com</strong></p>
            </div>
        </div>
    </div>

    <!-- Terms of Service Modal -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('termsModal')">&times;</span>
            <h2>üìÑ Terms of Service</h2>
            <div style="text-align: left; line-height: 1.6;">
                <h3>Last Updated: August 6, 2025</h3>
                
                <h4>1. Acceptance of Terms</h4>
                <p>By installing and using AutoScroll Extension, you agree to these terms.</p>
                
                <h4>2. Service Description</h4>
                <p>AutoScroll Extension provides automatic scrolling functionality for YouTube Shorts.</p>
                
                <h4>3. Subscription Terms</h4>
                <p>‚Ä¢ 10-day free trial for all new users</p>
                <p>‚Ä¢ ‚Çπ9/month subscription after trial period</p>
                <p>‚Ä¢ Automatic renewal unless canceled</p>
                <p>‚Ä¢ Cancel anytime from your account settings</p>
                
                <h4>4. Acceptable Use</h4>
                <p>‚Ä¢ Use the extension only for personal, non-commercial purposes</p>
                <p>‚Ä¢ Do not attempt to reverse engineer or modify the extension</p>
                <p>‚Ä¢ Do not use the extension to violate YouTube's terms of service</p>
                
                <h4>5. Refund Policy</h4>
                <p>‚Ä¢ Refunds available within 7 days of subscription</p>
                <p>‚Ä¢ Contact support for refund requests</p>
                
                <h4>6. Limitation of Liability</h4>
                <p>‚Ä¢ Extension provided "as is" without warranties</p>
                <p>‚Ä¢ We are not liable for any damages from extension use</p>
                
                <h4>7. Termination</h4>
                <p>‚Ä¢ We may terminate accounts that violate these terms</p>
                <p>‚Ä¢ You may cancel your subscription at any time</p>
                
                <h4>8. Contact</h4>
                <p>Questions about terms: <strong>sachinchaunal@gmail.com</strong></p>
            </div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <div id="subscriptionModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <span class="close subscription-modal-close">&times;</span>
            <h2>üöÄ Subscribe to Premium AutoScroll</h2>
            <p style="text-align: center; color: #666; margin-bottom: 30px;">‚Çπ9/month - Unlimited auto-scrolling with automatic renewal</p>
            
            <!-- UPI Input Section -->
            <div id="upiInputSection" class="subscription-section">
                <h3>üîÑ Set Up AutoPay Subscription</h3>
                <p style="color: #666; font-size: 14px; margin-bottom: 20px;">
                    Set up automatic monthly payments for uninterrupted premium access
                </p>
                
                <div class="autopay-benefits" style="margin: 20px 0;">
                    <ul style="list-style: none; padding: 0;">
                        <li style="padding: 8px 0; display: flex; align-items: center;">
                            <span style="color: #27ae60; margin-right: 10px;">‚úì</span>
                            Automatic monthly renewal (‚Çπ9/month)
                        </li>
                        <li style="padding: 8px 0; display: flex; align-items: center;">
                            <span style="color: #27ae60; margin-right: 10px;">‚úì</span>
                            Never lose access to premium features
                        </li>
                        <li style="padding: 8px 0; display: flex; align-items: center;">
                            <span style="color: #27ae60; margin-right: 10px;">‚úì</span>
                            Cancel anytime from website or extension
                        </li>
                        <li style="padding: 8px 0; display: flex; align-items: center;">
                            <span style="color: #27ae60; margin-right: 10px;">‚úì</span>
                            Secure UPI autopay mandate
                        </li>
                    </ul>
                </div>

                <div class="form-group">
                    <label for="userUpiId">Your UPI ID *</label>
                    <input type="text" id="userUpiId" placeholder="yourname@paytm" 
                           style="width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 5px;">
                    <small style="color: #666;">Enter your UPI ID (e.g., yourname@paytm, yourname@googlepay)</small>
                </div>

                <button id="createMandateBtn" type="button" class="submit-btn" style="width: 100%; margin-top: 20px; cursor: pointer;">
                    üîÑ Create AutoPay Subscription
                </button>
            </div>

            <!-- QR Code Section -->
            <div id="mandateQrSection" class="subscription-section" style="display: none;">
                <h3>üì± Scan QR Code to Setup AutoPay</h3>
                <div style="text-align: center; margin: 20px 0;">
                    <div id="qrCodeContainer" style="margin: 20px auto; max-width: 300px;"></div>
                    <p style="color: #666; margin: 10px 0;">Scan this QR code with any UPI app</p>
                    <div id="paymentLinkSection" style="margin: 20px 0;">
                        <a id="paymentLink" href="#" target="_blank" class="submit-btn" style="display: inline-block; text-decoration: none;">
                            üì± Open Payment Link
                        </a>
                    </div>
                </div>
            </div>

            <!-- Status Section -->
            <div id="mandateStatus" class="subscription-section" style="display: none;">
                <div id="statusContent">
                    <!-- Dynamic status content will be inserted here -->
                </div>
            </div>

            <!-- Loading -->
            <div id="subscriptionLoading" style="display: none; text-align: center; padding: 40px;">
                <div class="web-spinner"></div>
                <p>Setting up your subscription...</p>
            </div>
        </div>
    </div>

    <script>
        // Modal functions
        function openContactModal() {
            document.getElementById('contactModal').style.display = 'block';
        }
        
        function openSupportModal() {
            document.getElementById('supportModal').style.display = 'block';
        }
        
        function openPrivacyModal() {
            document.getElementById('privacyModal').style.display = 'block';
        }
        
        function openTermsModal() {
            document.getElementById('termsModal').style.display = 'block';
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }
        
        // Close modal when clicking outside
        window.onclick = function(event) {
            const modals = ['contactModal', 'supportModal', 'privacyModal', 'termsModal'];
            modals.forEach(modalId => {
                const modal = document.getElementById(modalId);
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        }
        
        // Download extension function
        function downloadExtension() {
            alert('ÔøΩ AutoScroll Extension ZIP Download\n\nüìã What you\'ll get:\n‚Ä¢ Complete AutoScroll Extension with all features\n‚Ä¢ All extension files in a convenient ZIP package\n‚Ä¢ Detailed installation guide included\n‚Ä¢ Ready-to-install extension folder\n\n‚úÖ Installation process:\n1. Download and extract the ZIP file\n2. Open Google Chrome\n3. Go to chrome://extensions/\n4. Enable "Developer mode" (toggle in top-right)\n5. Click "Load unpacked" and select the extracted folder\n\nüí° Much cleaner than batch files - just download, extract, and install!');
            
            // Trigger download
            window.location.href = '/api/download-extension';
        }
        
        function showDownloadInstructions() {
            alert('üåê Chrome Web Store\n\nOur extension is currently under review for the Chrome Web Store.\n\nüìÖ Expected availability: Soon\nüöÄ For immediate access, use our ZIP download for early access!\n\nüí° Clean and simple - no batch files needed!');
        }
        
        // Form submissions
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const submitBtn = e.target.querySelector('.submit-btn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';
            
            try {
                const response = await fetch('/api/contact', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        email: formData.get('email'),
                        subject: formData.get('subject'),
                        message: formData.get('message'),
                        type: 'contact'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Message sent successfully! We\'ll get back to you soon.');
                    e.target.reset();
                    closeModal('contactModal');
                } else {
                    alert('‚ùå Failed to send message. Please try again.');
                }
            } catch (error) {
                alert('‚ùå Network error. Please check your connection and try again.');
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Send Message';
        });
        
        document.getElementById('supportForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const submitBtn = e.target.querySelector('.submit-btn');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            try {
                const response = await fetch('/api/support', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        name: formData.get('name'),
                        email: formData.get('email'),
                        type: formData.get('type'),
                        message: formData.get('message'),
                        requestType: 'support'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    alert('‚úÖ Support request submitted successfully! We\'ll help you resolve this issue.');
                    e.target.reset();
                    closeModal('supportModal');
                } else {
                    alert('‚ùå Failed to submit request. Please try again.');
                }
            } catch (error) {
                alert('‚ùå Network error. Please check your connection and try again.');
            }
            
            submitBtn.disabled = false;
            submitBtn.textContent = 'Submit Support Request';
        });
        
        // Web Extension JavaScript Functionality - DISABLED
        // Users must download the Chrome extension instead
        /*
        class WebAutoScroll {
            constructor() {
                this.isAuthenticated = false;
                this.currentUser = null;
                this.subscriptionData = null;
                this.isAutoScrollActive = false;
                this.youTubeTab = null;
                this.checkInterval = null;
                this.API_BASE = window.location.origin;
                this.init();
            }

            async init() {
                console.log('WebAutoScroll: Initializing...');
                this.setupEventListeners();
                await this.checkAuthStatus();
                this.updateUI();
            }

            setupEventListeners() {
                // Login button
                const loginBtn = document.getElementById('webGoogleLoginBtn');
                if (loginBtn) {
                    loginBtn.addEventListener('click', () => this.handleGoogleLogin());
                }

                // Logout button
                const logoutBtn = document.getElementById('webLogoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', () => this.handleLogout());
                }

                // Toggle AutoScroll button
                const toggleBtn = document.getElementById('webToggleButton');
                if (toggleBtn) {
                    toggleBtn.addEventListener('click', () => this.toggleAutoScroll());
                }

                // Open YouTube button
                const youtubeBtn = document.getElementById('webOpenYouTubeBtn');
                if (youtubeBtn) {
                    youtubeBtn.addEventListener('click', () => this.openYouTubeShorts());
                }

                // Subscribe button
                const subscribeBtn = document.getElementById('webSubscribeButton');
                if (subscribeBtn) {
                    subscribeBtn.addEventListener('click', () => this.openSubscriptionModal());
                }
            }

            async checkAuthStatus() {
                try {
                    const authData = localStorage.getItem('webAutoScrollAuth');
                    if (authData) {
                        const parsed = JSON.parse(authData);
                        if (parsed.expiresAt > Date.now()) {
                            this.isAuthenticated = true;
                            this.currentUser = parsed.user;
                            await this.loadSubscriptionData();
                        } else {
                            localStorage.removeItem('webAutoScrollAuth');
                        }
                    }
                } catch (error) {
                    console.error('Auth check failed:', error);
                    localStorage.removeItem('webAutoScrollAuth');
                }
            }

            async loadSubscriptionData() {
                try {
                    const authData = JSON.parse(localStorage.getItem('webAutoScrollAuth'));
                    const response = await fetch(`${this.API_BASE}/api/trials/trial-status/${authData.userId}`, {
                        headers: {
                            'Authorization': `Bearer ${authData.token}`
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        this.subscriptionData = result.data;
                    }
                } catch (error) {
                    console.error('Failed to load subscription data:', error);
                }
            }

            async handleGoogleLogin() {
                try {
                    this.showLoading(true);
                    
                    // Create a popup for Google OAuth with implicit flow
                    const popup = window.open(
                        `${this.API_BASE}/api/auth/google?response_type=token&state=web_auth_${Date.now()}`, 
                        'googleLogin', 
                        'width=500,height=600,scrollbars=yes,resizable=yes'
                    );
                    
                    // Wait for the popup to complete authentication
                    const checkClosed = setInterval(() => {
                        if (popup.closed) {
                            clearInterval(checkClosed);
                            this.checkAuthSuccess();
                        }
                    }, 1000);

                    // Listen for messages from the popup
                    window.addEventListener('message', (event) => {
                        if (event.origin !== this.API_BASE) return;
                        
                        if (event.data.type === 'GOOGLE_AUTH_SUCCESS') {
                            clearInterval(checkClosed);
                            popup.close();
                            this.handleAuthSuccess(event.data);
                        }
                    });

                } catch (error) {
                    console.error('Login error:', error);
                    this.showError('Login failed: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            async checkAuthSuccess() {
                // Check if auth was successful by making a test API call
                try {
                    const response = await fetch(`${this.API_BASE}/api/auth/me`, {
                        credentials: 'include'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success) {
                            await this.handleAuthSuccess(result.data);
                        }
                    }
                } catch (error) {
                    console.log('Auth check after popup failed:', error);
                }
            }

            async handleAuthSuccess(authData) {
                try {
                    this.isAuthenticated = true;
                    this.currentUser = authData.user;
                    
                    // Store auth data locally
                    localStorage.setItem('webAutoScrollAuth', JSON.stringify({
                        user: authData.user,
                        token: authData.token,
                        userId: authData.userId,
                        expiresAt: Date.now() + (24 * 60 * 60 * 1000) // 24 hours
                    }));

                    await this.loadSubscriptionData();
                    this.updateUI();
                    this.showNotification('Welcome!', 'Login successful! You can now use AutoScroll.');

                } catch (error) {
                    console.error('Auth success handling failed:', error);
                    this.showError('Authentication failed. Please try again.');
                }
            }

            async handleLogout() {
                try {
                    this.showLoading(true);
                    
                    // Stop any active autoscroll
                    if (this.isAutoScrollActive) {
                        await this.stopAutoScroll();
                    }

                    // Clear local storage
                    localStorage.removeItem('webAutoScrollAuth');
                    
                    // Reset state
                    this.isAuthenticated = false;
                    this.currentUser = null;
                    this.subscriptionData = null;
                    
                    this.updateUI();
                    this.showNotification('Logged out', 'You have been logged out successfully.');

                } catch (error) {
                    console.error('Logout error:', error);
                } finally {
                    this.showLoading(false);
                }
            }

            async toggleAutoScroll() {
                if (!this.subscriptionData || !this.subscriptionData.canUseExtension) {
                    this.showError('Your trial has expired. Please subscribe to continue.');
                    this.openSubscriptionModal();
                    return;
                }

                if (this.isAutoScrollActive) {
                    await this.stopAutoScroll();
                } else {
                    await this.startAutoScroll();
                }
            }

            async startAutoScroll() {
                try {
                    // Check if YouTube Shorts tab exists
                    if (!this.youTubeTab || this.youTubeTab.closed) {
                        this.showError('Please open YouTube Shorts first or click "Open YouTube Shorts" button.');
                        return;
                    }

                    // Send message to YouTube tab to start autoscroll
                    try {
                        this.youTubeTab.postMessage({
                            type: 'START_AUTOSCROLL',
                            source: 'webAutoScroll'
                        }, 'https://www.youtube.com');
                    } catch (error) {
                        this.showError('Could not communicate with YouTube tab. Please ensure the tab is open and try again.');
                        return;
                    }

                    this.isAutoScrollActive = true;
                    this.updateAutoScrollStatus();
                    this.showNotification('AutoScroll Started', 'Switch to your YouTube Shorts tab to see it in action!');

                    // Start monitoring the YouTube tab
                    this.startMonitoring();

                } catch (error) {
                    console.error('Start AutoScroll error:', error);
                    this.showError('Failed to start AutoScroll: ' + error.message);
                }
            }

            async stopAutoScroll() {
                try {
                    // Send stop message to YouTube tab
                    if (this.youTubeTab && !this.youTubeTab.closed) {
                        this.youTubeTab.postMessage({
                            type: 'STOP_AUTOSCROLL',
                            source: 'webAutoScroll'
                        }, 'https://www.youtube.com');
                    }

                    this.isAutoScrollActive = false;
                    this.updateAutoScrollStatus();
                    this.stopMonitoring();
                    this.showNotification('AutoScroll Stopped', 'AutoScroll has been stopped.');

                } catch (error) {
                    console.error('Stop AutoScroll error:', error);
                    this.showError('Failed to stop AutoScroll: ' + error.message);
                }
            }

            openYouTubeShorts() {
                const shortsUrl = 'https://www.youtube.com/shorts';
                this.youTubeTab = window.open(shortsUrl, 'youtubeShorts');
                
                if (this.youTubeTab) {
                    this.showNotification('YouTube Opened', 'YouTube Shorts opened in a new tab. You can now start AutoScroll!');
                    
                    // Wait for the tab to load, then inject our script
                    setTimeout(() => {
                        this.injectAutoScrollScript();
                    }, 3000);
                } else {
                    this.showError('Failed to open YouTube Shorts. Please check your popup blocker settings.');
                }
            }

            injectAutoScrollScript() {
                if (!this.youTubeTab || this.youTubeTab.closed) return;

                try {
                    // Inject our YouTube autoscroll script
                    const script = `
                        // Web AutoScroll for YouTube Shorts
                        let webAutoScrollActive = false;
                        let currentVideo = null;
                        let monitorInterval = null;

                        function getCurrentVideo() {
                            return document.querySelector('video');
                        }

                        function scrollToNext() {
                            const event = new KeyboardEvent('keydown', {
                                key: 'ArrowDown',
                                code: 'ArrowDown',
                                keyCode: 40,
                                which: 40,
                                bubbles: true
                            });
                            document.dispatchEvent(event);
                        }

                        function startWebAutoScroll() {
                            if (webAutoScrollActive) return;
                            
                            webAutoScrollActive = true;
                            console.log('Web AutoScroll: Started');
                            
                            monitorInterval = setInterval(() => {
                                if (!webAutoScrollActive) return;
                                
                                const video = getCurrentVideo();
                                if (!video || !video.duration) return;
                                
                                const timeRemaining = video.duration - video.currentTime;
                                if (timeRemaining <= 0.5 || video.ended) {
                                    scrollToNext();
                                    // Brief pause to let new video load
                                    setTimeout(() => {
                                        if (webAutoScrollActive) {
                                            // Video changed, continue monitoring
                                        }
                                    }, 2000);
                                }
                            }, 500);
                        }

                        function stopWebAutoScroll() {
                            webAutoScrollActive = false;
                            if (monitorInterval) {
                                clearInterval(monitorInterval);
                                monitorInterval = null;
                            }
                            console.log('Web AutoScroll: Stopped');
                        }

                        // Listen for messages from parent window
                        window.addEventListener('message', (event) => {
                            if (event.origin !== '${window.location.origin}') return;
                            
                            if (event.data.type === 'START_AUTOSCROLL') {
                                startWebAutoScroll();
                            } else if (event.data.type === 'STOP_AUTOSCROLL') {
                                stopWebAutoScroll();
                            }
                        });

                        console.log('Web AutoScroll: Script injected and ready');
                    `;

                    // We can't directly inject script due to CORS, so we'll use postMessage
                    // The user will need to manually paste this or we'll provide instructions
                    console.log('AutoScroll script ready for YouTube tab');

                } catch (error) {
                    console.error('Script injection failed:', error);
                }
            }

            startMonitoring() {
                this.stopMonitoring(); // Clear any existing interval
                
                this.checkInterval = setInterval(() => {
                    if (!this.youTubeTab || this.youTubeTab.closed) {
                        this.isAutoScrollActive = false;
                        this.updateAutoScrollStatus();
                        this.stopMonitoring();
                        this.showNotification('YouTube Closed', 'YouTube tab was closed. AutoScroll stopped.');
                    }
                }, 2000);
            }

            stopMonitoring() {
                if (this.checkInterval) {
                    clearInterval(this.checkInterval);
                    this.checkInterval = null;
                }
            }

            openSubscriptionModal() {
                // Open the subscription modal instead of showing placeholder
                this.showSubscriptionModal();
            }

            showSubscriptionModal() {
                const modal = document.getElementById('subscriptionModal');
                if (modal) {
                    modal.style.display = 'block';
                    this.resetSubscriptionModal();
                    this.checkForExistingMandates();
                }
            }

            resetSubscriptionModal() {
                // Show UPI input section by default
                const upiSection = document.getElementById('upiInputSection');
                const qrSection = document.getElementById('mandateQrSection');
                const statusSection = document.getElementById('mandateStatus');
                const loadingSection = document.getElementById('subscriptionLoading');

                if (upiSection) upiSection.style.display = 'block';
                if (qrSection) qrSection.style.display = 'none';
                if (statusSection) statusSection.style.display = 'none';
                if (loadingSection) loadingSection.style.display = 'none';

                // Clear form
                const upiInput = document.getElementById('userUpiId');
                if (upiInput) upiInput.value = '';
            }

            async checkForExistingMandates() {
                try {
                    const authData = localStorage.getItem('webAutoScrollAuth');
                    if (!authData) return;

                    const parsed = JSON.parse(authData);
                    const response = await fetch(`${this.API_BASE}/api/upi-mandates/status/${parsed.userId}`, {
                        headers: {
                            'Authorization': `Bearer ${parsed.token}`
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.data.hasMandate) {
                            this.showExistingMandateStatus(result.data);
                        }
                    }
                } catch (error) {
                    console.log('Could not check existing mandates:', error);
                }
            }

            showExistingMandateStatus(mandateData) {
                const upiSection = document.getElementById('upiInputSection');
                const statusSection = document.getElementById('mandateStatus');
                const statusContent = document.getElementById('statusContent');

                if (upiSection) upiSection.style.display = 'none';
                if (statusSection) statusSection.style.display = 'block';

                let statusClass = 'status-card';
                let statusIcon = 'üîÑ';
                let statusText = 'Active';
                let actions = '';

                switch (mandateData.status) {
                    case 'ACTIVE':
                        statusClass += ' success';
                        statusIcon = '‚úÖ';
                        statusText = 'Active';
                        actions = `
                            <div class="subscription-actions">
                                <button class="btn-danger cancel-mandate-btn" data-mandate-id="${mandateData.mandateId}">
                                    Cancel Subscription
                                </button>
                            </div>
                        `;
                        break;
                    case 'PENDING':
                        statusClass += ' pending';
                        statusIcon = '‚è≥';
                        statusText = 'Pending Setup';
                        actions = `
                            <div class="subscription-actions">
                                <button class="btn-success check-status-btn" data-mandate-id="${mandateData.mandateId}" style="cursor: pointer;">
                                    Check Status
                                </button>
                                <button class="btn-secondary show-qr-btn" data-mandate-id="${mandateData.mandateId}" style="cursor: pointer;">
                                    Show QR Code
                                </button>
                            </div>
                        `;
                        break;
                    case 'CANCELLED':
                        statusClass += ' error';
                        statusIcon = '‚ùå';
                        statusText = 'Cancelled';
                        actions = `
                            <div class="subscription-actions">
                                <button class="btn-success create-new-mandate-btn">
                                    Create New Subscription
                                </button>
                            </div>
                        `;
                        break;
                }

                if (statusContent) {
                    statusContent.innerHTML = `
                        <div class="${statusClass}">
                            <h4>${statusIcon} Subscription Status: ${statusText}</h4>
                            <div class="mandate-details">
                                <p><strong>Mandate ID:</strong></p>
                                <p class="mandate-id">${mandateData.mandateId}</p>
                                <p><strong>Amount:</strong> ‚Çπ${mandateData.amount || 9}/month</p>
                                <p><strong>Status:</strong> ${mandateData.status}</p>
                                ${mandateData.nextChargeDate ? `<p><strong>Next Charge:</strong> ${new Date(mandateData.nextChargeDate).toLocaleDateString()}</p>` : ''}
                            </div>
                            ${actions}
                        </div>
                    `;
                    
                    // Add event listeners for dynamically created buttons
                    this.attachMandateButtonListeners();
                }
            }

            attachMandateButtonListeners() {
                console.log('üîó Attaching mandate button listeners...');
                
                // Check Status buttons
                const checkStatusBtns = document.querySelectorAll('.check-status-btn');
                checkStatusBtns.forEach(btn => {
                    const mandateId = btn.getAttribute('data-mandate-id');
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('üîç Check Status clicked for mandate:', mandateId);
                        checkMandateStatus(mandateId);
                    });
                    console.log('‚úÖ Check Status listener added for mandate:', mandateId);
                });

                // Show QR buttons
                const showQrBtns = document.querySelectorAll('.show-qr-btn');
                showQrBtns.forEach(btn => {
                    const mandateId = btn.getAttribute('data-mandate-id');
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('üì± Show QR clicked for mandate:', mandateId);
                        showMandateQR(mandateId);
                    });
                    console.log('‚úÖ Show QR listener added for mandate:', mandateId);
                });

                // Cancel Mandate buttons
                const cancelBtns = document.querySelectorAll('.cancel-mandate-btn');
                cancelBtns.forEach(btn => {
                    const mandateId = btn.getAttribute('data-mandate-id');
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('‚ùå Cancel Mandate clicked for mandate:', mandateId);
                        cancelMandate(mandateId);
                    });
                    console.log('‚úÖ Cancel Mandate listener added for mandate:', mandateId);
                });

                // Create New Mandate buttons
                const createNewBtns = document.querySelectorAll('.create-new-mandate-btn');
                createNewBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.preventDefault();
                        console.log('üÜï Create New Mandate clicked');
                        createNewMandate();
                    });
                    console.log('‚úÖ Create New Mandate listener added');
                });

                console.log('üéâ All mandate button listeners attached successfully!');
            }

            updateUI() {
                if (this.isAuthenticated) {
                    this.showMainScreen();
                    this.updateUserInfo();
                    this.updateSubscriptionInfo();
                } else {
                    this.showLoginScreen();
                }
                this.updateAutoScrollStatus();
            }

            showLoginScreen() {
                document.getElementById('webLoginScreen').style.display = 'block';
                document.getElementById('webMainScreen').style.display = 'none';
            }

            showMainScreen() {
                document.getElementById('webLoginScreen').style.display = 'none';
                document.getElementById('webMainScreen').style.display = 'block';
            }

            updateUserInfo() {
                if (!this.currentUser) return;

                const userPicture = document.getElementById('webUserPicture');
                const userName = document.getElementById('webUserName');
                const userEmail = document.getElementById('webUserEmail');

                if (userPicture) {
                    userPicture.src = this.currentUser.picture || '/extension/icons/icon48.png';
                    userPicture.alt = this.currentUser.name || 'User';
                }

                if (userName) {
                    userName.textContent = this.currentUser.name || 'Unknown User';
                }

                if (userEmail) {
                    userEmail.textContent = this.currentUser.email || 'No email';
                }
            }

            updateSubscriptionInfo() {
                if (!this.subscriptionData) return;

                const trialInfo = document.getElementById('webTrialInfo');
                const subscriptionStatus = document.getElementById('webSubscriptionStatus');
                const expiredNotice = document.getElementById('webExpiredNotice');
                const trialDays = document.getElementById('webTrialDays');
                const trialProgress = document.getElementById('webTrialProgress');

                // Hide all sections first
                if (trialInfo) trialInfo.style.display = 'none';
                if (subscriptionStatus) subscriptionStatus.style.display = 'none';
                if (expiredNotice) expiredNotice.style.display = 'none';

                if (this.subscriptionData.subscriptionStatus === 'trial') {
                    if (trialInfo) trialInfo.style.display = 'block';
                    if (trialDays) {
                        trialDays.textContent = `${this.subscriptionData.trialDaysRemaining} days remaining`;
                    }
                    if (trialProgress) {
                        const progressPercent = (this.subscriptionData.trialDaysRemaining / 10) * 100;
                        trialProgress.style.width = `${Math.max(0, progressPercent)}%`;
                    }
                } else if (this.subscriptionData.subscriptionStatus === 'active') {
                    if (subscriptionStatus) subscriptionStatus.style.display = 'block';
                } else {
                    if (expiredNotice) expiredNotice.style.display = 'block';
                }
            }

            updateAutoScrollStatus() {
                const statusDot = document.getElementById('webStatusDot');
                const statusText = document.getElementById('webStatusText');
                const toggleButton = document.getElementById('webToggleButton');

                if (this.isAutoScrollActive) {
                    if (statusDot) statusDot.className = 'web-status-dot active';
                    if (statusText) statusText.textContent = 'Active';
                    if (toggleButton) {
                        toggleButton.textContent = 'Stop AutoScroll';
                        toggleButton.className = 'web-btn web-btn-danger';
                        toggleButton.style.background = '#e74c3c';
                    }
                } else {
                    if (statusDot) statusDot.className = 'web-status-dot';
                    if (statusText) statusText.textContent = 'Inactive';
                    if (toggleButton) {
                        toggleButton.textContent = 'Start AutoScroll';
                        toggleButton.className = 'web-btn web-btn-primary';
                        toggleButton.style.background = '#3498db';
                    }
                }

                // Disable button if can't use extension
                if (toggleButton && this.subscriptionData && !this.subscriptionData.canUseExtension) {
                    toggleButton.disabled = true;
                    toggleButton.textContent = 'Trial Expired - Subscribe';
                    toggleButton.style.background = '#95a5a6';
                }
            }

            showLoading(show) {
                const loadingScreen = document.getElementById('webLoadingScreen');
                const loginScreen = document.getElementById('webLoginScreen');
                const mainScreen = document.getElementById('webMainScreen');

                if (show) {
                    if (loadingScreen) loadingScreen.style.display = 'flex';
                    if (loginScreen) loginScreen.style.display = 'none';
                    if (mainScreen) mainScreen.style.display = 'none';
                } else {
                    if (loadingScreen) loadingScreen.style.display = 'none';
                    this.updateUI();
                }
            }

            showNotification(title, message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #27ae60;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 999999;
                    font-family: Arial, sans-serif;
                    max-width: 300px;
                    cursor: pointer;
                `;
                
                notification.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                    <div style="font-size: 14px;">${message}</div>
                `;
                
                notification.addEventListener('click', () => notification.remove());
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }

            showError(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #e74c3c;
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    z-index: 999999;
                    font-family: Arial, sans-serif;
                    max-width: 300px;
                    cursor: pointer;
                `;
                
                notification.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">Error</div>
                    <div style="font-size: 14px;">${message}</div>
                `;
                
                notification.addEventListener('click', () => notification.remove());
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 7000);
            }
        }
        */

        // Web AutoScroll functionality disabled - users must use Chrome extension
        // Initialize Web AutoScroll when page loads
        document.addEventListener('DOMContentLoaded', () => {
            // window.webAutoScrollInstance = new WebAutoScroll();
            console.log('Web AutoScroll disabled - please use Chrome extension');
        });

        // Global subscription functions
        function closeSubscriptionModal() {
            const modal = document.getElementById('subscriptionModal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        async function createWebUpiMandate() {
            console.log('üîÑ Create AutoPay Subscription function called!');
            
            try {
                // Get UPI ID
                const upiInput = document.getElementById('userUpiId');
                if (!upiInput) {
                    throw new Error('UPI input field not found');
                }
                
                const upiId = upiInput.value.trim();
                console.log('UPI ID entered:', upiId);
                
                if (!upiId) {
                    alert('Please enter a valid UPI ID');
                    upiInput.focus();
                    return;
                }

                if (!isValidUpiId(upiId)) {
                    alert('Please enter a valid UPI ID (e.g., yourname@paytm)');
                    upiInput.focus();
                    return;
                }

                console.log('UPI ID validation passed');
                console.log('Showing loading...');
                showSubscriptionLoading(true);

                // Get authentication data
                const authData = localStorage.getItem('webAutoScrollAuth');
                console.log('Auth data from localStorage:', !!authData);
                
                if (!authData) {
                    throw new Error('Please log in first to create subscription');
                }

                let parsed;
                try {
                    parsed = JSON.parse(authData);
                    console.log('Parsed auth data - userId:', parsed.userId, 'hasToken:', !!parsed.token);
                } catch (parseError) {
                    console.error('Failed to parse auth data:', parseError);
                    throw new Error('Invalid authentication data. Please log in again.');
                }
                
                if (!parsed.userId || !parsed.token) {
                    throw new Error('Incomplete authentication data. Please log in again.');
                }

                // Use the current origin for API calls (works for both localhost and deployed)
                const apiUrl = `${window.location.origin}/api/upi-mandates/create-mandate`;
                console.log('API URL:', apiUrl);
                
                const requestBody = {
                    userId: parsed.userId,
                    userUpiId: upiId,
                    amount: 9
                };
                console.log('Request body:', requestBody);
                
                const requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${parsed.token}`
                    },
                    body: JSON.stringify(requestBody)
                };
                console.log('Making API request...');

                const response = await fetch(apiUrl, requestOptions);
                console.log('Response received - status:', response.status, 'ok:', response.ok);

                if (!response.ok) {
                    let errorMessage = `HTTP ${response.status}`;
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.message || errorData.error || errorMessage;
                    } catch (e) {
                        const errorText = await response.text();
                        errorMessage = errorText || errorMessage;
                    }
                    console.error('API response error:', errorMessage);
                    throw new Error(`Server error: ${errorMessage}`);
                }

                const result = await response.json();
                console.log('API response data:', result);
                
                if (result.success) {
                    console.log('Mandate creation successful!');
                    
                    if (result.data.qrCodeImage && result.data.paymentUrl) {
                        console.log('Showing QR code for new mandate...');
                        showMandateQRCode(result.data);
                    } else if (result.data.mandateId) {
                        console.log('Showing existing mandate...');
                        showExistingMandateFromResult(result.data);
                    } else {
                        console.log('Unexpected response format:', result.data);
                        throw new Error('Unexpected server response format');
                    }
                } else {
                    throw new Error(result.message || result.error || 'Failed to create mandate');
                }

            } catch (error) {
                console.error('Mandate creation error:', error);
                alert('Failed to create subscription: ' + error.message);
            } finally {
                console.log('Hiding loading...');
                showSubscriptionLoading(false);
            }
        }

        // Make functions globally available
        window.createWebUpiMandate = createWebUpiMandate;
        window.closeSubscriptionModal = closeSubscriptionModal;
        window.handleCreateMandate = handleCreateMandate;
        window.checkMandateStatus = checkMandateStatus;
        window.showMandateQR = showMandateQR;
        window.cancelMandate = cancelMandate;
        window.createNewMandate = createNewMandate;
        window.fetchMandateQR = fetchMandateQR;
        
        // Debug information
        console.log('üöÄ AutoScroll Website JavaScript Loaded');
        console.log('Available functions:', {
            createWebUpiMandate: typeof window.createWebUpiMandate,
            closeSubscriptionModal: typeof window.closeSubscriptionModal,
            handleCreateMandate: typeof window.handleCreateMandate,
            checkMandateStatus: typeof window.checkMandateStatus,
            showMandateQR: typeof window.showMandateQR,
            cancelMandate: typeof window.cancelMandate,
            createNewMandate: typeof window.createNewMandate,
            fetchMandateQR: typeof window.fetchMandateQR
        });
        
        // Check if elements exist when page loads
        setTimeout(() => {
            console.log('üîç Checking for subscription modal elements...');
            console.log('Elements check:', {
                subscriptionModal: !!document.getElementById('subscriptionModal'),
                createMandateBtn: !!document.getElementById('createMandateBtn'),
                userUpiId: !!document.getElementById('userUpiId'),
                upiInputSection: !!document.getElementById('upiInputSection'),
                mandateQrSection: !!document.getElementById('mandateQrSection'),
                subscriptionLoading: !!document.getElementById('subscriptionLoading')
            });
        }, 1000);

        function showMandateQRCode(mandateData) {
            console.log('showMandateQRCode called with:', mandateData);
            
            const upiSection = document.getElementById('upiInputSection');
            const qrSection = document.getElementById('mandateQrSection');
            const qrContainer = document.getElementById('qrCodeContainer');
            const paymentLink = document.getElementById('paymentLink');

            console.log('QR Elements found:', {
                upiSection: !!upiSection,
                qrSection: !!qrSection,
                qrContainer: !!qrContainer,
                paymentLink: !!paymentLink
            });

            // Hide UPI input section
            if (upiSection) {
                upiSection.style.display = 'none';
                console.log('Hidden UPI section');
            }
            
            // Show QR section
            if (qrSection) {
                qrSection.style.display = 'block';
                console.log('Showing QR section');
            } else {
                console.error('QR section not found!');
                return;
            }

            // Set QR code image
            if (qrContainer && mandateData.qrCodeImage) {
                qrContainer.innerHTML = `<img src="${mandateData.qrCodeImage}" alt="UPI QR Code" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;">`;
                console.log('QR code image set');
            } else {
                console.error('QR container not found or no QR image data');
            }

            // Set payment link
            if (paymentLink && mandateData.paymentUrl) {
                paymentLink.href = mandateData.paymentUrl;
                paymentLink.target = '_blank';
                console.log('Payment link set:', mandateData.paymentUrl);
            } else {
                console.error('Payment link element not found or no payment URL');
            }

            // Start checking mandate status
            if (mandateData.mandateId) {
                console.log('Starting mandate status checking for ID:', mandateData.mandateId);
                checkMandateStatusPeriodically(mandateData.mandateId);
            } else {
                console.error('No mandate ID provided for status checking');
            }
        }

        function showExistingMandateFromResult(mandateData) {
            // Access the global webAutoScroll instance
            if (window.webAutoScrollInstance) {
                window.webAutoScrollInstance.showExistingMandateStatus(mandateData);
            }
        }

        async function checkMandateStatus(mandateId) {
            console.log('üîç checkMandateStatus called with mandateId:', mandateId);
            alert('üîç Check Status function called! Mandate ID: ' + mandateId);
            
            try {
                showSubscriptionLoading(true);
                
                const authData = localStorage.getItem('webAutoScrollAuth');
                if (!authData) {
                    throw new Error('Please log in first');
                }

                const parsed = JSON.parse(authData);
                const response = await fetch(`${window.location.origin}/api/upi-mandates/status/${parsed.userId}`, {
                    headers: {
                        'Authorization': `Bearer ${parsed.token}`
                    }
                });

                console.log('Status check response status:', response.status);

                if (response.ok) {
                    const result = await response.json();
                    console.log('Status check result:', result);
                    
                    if (result.success) {
                        if (window.webAutoScrollInstance) {
                            window.webAutoScrollInstance.showExistingMandateStatus(result.data);
                        }
                        
                        if (result.data.status === 'ACTIVE') {
                            showGlobalNotification('Success!', 'Your subscription is now active!');
                            return true;
                        } else if (result.data.status === 'PENDING') {
                            showGlobalNotification('Still Pending', 'Payment is still being processed. Please try again in a few moments.');
                        } else {
                            showGlobalNotification('Status Updated', `Subscription status: ${result.data.status}`);
                        }
                        return false;
                    } else {
                        throw new Error(result.message || 'Failed to check status');
                    }
                } else {
                    throw new Error(`Server error: ${response.status}`);
                }
            } catch (error) {
                console.error('Status check error:', error);
                alert('‚ùå Error checking mandate status: ' + error.message);
                return false;
            } finally {
                showSubscriptionLoading(false);
            }
        }

        function checkMandateStatusPeriodically(mandateId) {
            const interval = setInterval(async () => {
                try {
                    const authData = localStorage.getItem('webAutoScrollAuth');
                    if (!authData) {
                        clearInterval(interval);
                        return;
                    }

                    const parsed = JSON.parse(authData);
                    const response = await fetch(`${window.location.origin}/api/upi-mandates/status/${parsed.userId}`, {
                        headers: {
                            'Authorization': `Bearer ${parsed.token}`
                        }
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.data.status === 'ACTIVE') {
                            clearInterval(interval);
                            if (window.webAutoScrollInstance) {
                                window.webAutoScrollInstance.showExistingMandateStatus(result.data);
                            }
                            showGlobalNotification('Success!', 'Your subscription is now active!');
                        }
                    }
                } catch (error) {
                    console.log('Periodic check error:', error);
                }
            }, 5000); // Check every 5 seconds

            // Stop checking after 10 minutes
            setTimeout(() => clearInterval(interval), 10 * 60 * 1000);
        }

        async function cancelMandate(mandateId) {
            if (!confirm('Are you sure you want to cancel your subscription? You will lose access to premium features.')) {
                return;
            }

            try {
                const authData = localStorage.getItem('webAutoScrollAuth');
                if (!authData) return;

                const parsed = JSON.parse(authData);
                const response = await fetch(`${window.location.origin}/api/upi-mandates/cancel/${parsed.userId}`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${parsed.token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        showGlobalNotification('Cancelled', 'Your subscription has been cancelled.');
                        checkMandateStatus(mandateId);
                    }
                }
            } catch (error) {
                console.error('Cancel error:', error);
                alert('Failed to cancel subscription: ' + error.message);
            }
        }

        function createNewMandate() {
            if (window.webAutoScrollInstance) {
                window.webAutoScrollInstance.resetSubscriptionModal();
            }
        }

        function showMandateQR(mandateId) {
            console.log('üì± showMandateQR called with mandateId:', mandateId);
            alert('üì± Show QR function called! Mandate ID: ' + mandateId);
            
            try {
                // Show QR section for existing mandate
                const upiSection = document.getElementById('upiInputSection');
                const statusSection = document.getElementById('mandateStatus');
                const qrSection = document.getElementById('mandateQrSection');

                if (upiSection) {
                    upiSection.style.display = 'none';
                    console.log('Hidden UPI section');
                }
                if (statusSection) {
                    statusSection.style.display = 'none';
                    console.log('Hidden status section');
                }
                if (qrSection) {
                    qrSection.style.display = 'block';
                    console.log('Showing QR section');
                }

                // Show loading message
                const qrContainer = document.getElementById('qrCodeContainer');
                if (qrContainer) {
                    qrContainer.innerHTML = '<div class="web-spinner" style="margin: 20px auto;"></div><p>Loading QR code...</p>';
                    console.log('Showing loading in QR container');
                }

                // Fetch QR code for existing mandate
                fetchMandateQR(mandateId);
            } catch (error) {
                console.error('Error showing mandate QR:', error);
                alert('‚ùå Error loading QR code: ' + error.message);
            }
        }

        async function fetchMandateQR(mandateId) {
            try {
                const authData = localStorage.getItem('webAutoScrollAuth');
                if (!authData) {
                    throw new Error('Please log in first');
                }

                const parsed = JSON.parse(authData);
                console.log('Fetching QR for mandate:', mandateId);

                const response = await fetch(`${window.location.origin}/api/upi-mandates/qr/${mandateId}`, {
                    headers: {
                        'Authorization': `Bearer ${parsed.token}`
                    }
                });

                console.log('QR fetch response status:', response.status);

                if (!response.ok) {
                    throw new Error(`Failed to fetch QR code: ${response.status}`);
                }

                const result = await response.json();
                console.log('QR fetch result:', result);

                if (result.success && result.data) {
                    const qrContainer = document.getElementById('qrCodeContainer');
                    const paymentLink = document.getElementById('paymentLink');
                    
                    if (qrContainer && result.data.qrCodeImage) {
                        qrContainer.innerHTML = `<img src="${result.data.qrCodeImage}" alt="UPI QR Code" style="max-width: 100%; height: auto; border: 1px solid #ddd; border-radius: 8px;">`;
                        console.log('QR code image set');
                    }
                    
                    if (paymentLink && result.data.paymentUrl) {
                        paymentLink.href = result.data.paymentUrl;
                        paymentLink.target = '_blank';
                        console.log('Payment link set:', result.data.paymentUrl);
                    }
                } else {
                    throw new Error(result.message || 'Failed to generate QR code');
                }
            } catch (error) {
                console.error('Fetch mandate QR error:', error);
                const qrContainer = document.getElementById('qrCodeContainer');
                if (qrContainer) {
                    qrContainer.innerHTML = `<p style="color: #e74c3c;">‚ùå Error loading QR code: ${error.message}</p>`;
                }
            }
        }

        function showSubscriptionLoading(show) {
            console.log('showSubscriptionLoading called with:', show);
            
            const upiSection = document.getElementById('upiInputSection');
            const qrSection = document.getElementById('mandateQrSection');
            const statusSection = document.getElementById('mandateStatus');
            const loadingSection = document.getElementById('subscriptionLoading');

            console.log('Elements found:', {
                upiSection: !!upiSection,
                qrSection: !!qrSection, 
                statusSection: !!statusSection,
                loadingSection: !!loadingSection
            });

            if (show) {
                // Hide all other sections
                if (upiSection) {
                    upiSection.style.display = 'none';
                    console.log('Hidden UPI section');
                }
                if (qrSection) {
                    qrSection.style.display = 'none';
                    console.log('Hidden QR section');
                }
                if (statusSection) {
                    statusSection.style.display = 'none';
                    console.log('Hidden status section');
                }
                
                // Show loading
                if (loadingSection) {
                    loadingSection.style.display = 'block';
                    console.log('Showing loading section');
                } else {
                    console.error('Loading section not found!');
                }
            } else {
                // Hide loading
                if (loadingSection) {
                    loadingSection.style.display = 'none';
                    console.log('Hidden loading section');
                }
                
                // Show UPI section again if no other section is visible
                if (upiSection && (!qrSection || qrSection.style.display === 'none') && 
                    (!statusSection || statusSection.style.display === 'none')) {
                    upiSection.style.display = 'block';
                    console.log('Showing UPI section again');
                }
            }
        }

        function isValidUpiId(upiId) {
            // Basic UPI ID validation
            const upiRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+$/;
            return upiRegex.test(upiId) && upiId.includes('@');
        }

        function showGlobalNotification(title, message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: #27ae60;
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 999999;
                font-family: Arial, sans-serif;
                max-width: 300px;
                cursor: pointer;
            `;
            
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 5px;">${title}</div>
                <div style="font-size: 14px;">${message}</div>
            `;
            
            notification.addEventListener('click', () => notification.remove());
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Add scroll animations
        document.addEventListener('DOMContentLoaded', function() {
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };
            
            const observer = new IntersectionObserver(function(entries) {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);
            
            // Observe all feature cards
            document.querySelectorAll('.feature-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });

        // Add event listener for the Create AutoPay Subscription button
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up event listeners...');
            
            const createMandateBtn = document.getElementById('createMandateBtn');
            if (createMandateBtn) {
                console.log('Create mandate button found, adding event listener...');
                
                // Remove any existing listeners
                createMandateBtn.removeEventListener('click', handleCreateMandate);
                
                // Add new listener
                createMandateBtn.addEventListener('click', handleCreateMandate);
                
                // Also add onclick as fallback
                createMandateBtn.onclick = handleCreateMandate;
                
                console.log('Event listeners added successfully');
            } else {
                console.error('Create mandate button not found!');
            }

            // Add subscription modal close button listener
            const subscriptionModalClose = document.querySelector('.subscription-modal-close');
            if (subscriptionModalClose) {
                subscriptionModalClose.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Subscription modal close clicked');
                    closeSubscriptionModal();
                });
                console.log('Subscription modal close listener added');
            } else {
                console.error('Subscription modal close button not found!');
            }

            // Add download button event listeners
            const chromeStoreBtn = document.getElementById('chromeStoreBtn');
            if (chromeStoreBtn) {
                chromeStoreBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Chrome Store button clicked');
                    showDownloadInstructions();
                });
                console.log('Chrome Store button listener added');
            } else {
                console.error('Chrome Store button not found!');
            }

            const windowsInstallerBtn = document.getElementById('windowsInstallerBtn');
            if (windowsInstallerBtn) {
                windowsInstallerBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('ZIP Download button clicked');
                    downloadExtension();
                });
                console.log('ZIP Download button listener added');
            } else {
                console.error('ZIP Download button not found!');
            }
        });

        // Separate handler function for better debugging
        function handleCreateMandate(e) {
            console.log('üîÑ Button clicked! Event:', e);
            e.preventDefault();
            e.stopPropagation();
            
            try {
                createWebUpiMandate();
            } catch (error) {
                console.error('Error calling createWebUpiMandate:', error);
                alert('Error: ' + error.message);
            }
        }
    </script>
</body>
</html>
